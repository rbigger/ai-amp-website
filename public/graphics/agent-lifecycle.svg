<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 800 450" width="800" height="450">
  <defs>
    <style>
      .title { font-family: system-ui, -apple-system, sans-serif; font-size: 24px; font-weight: 600; fill: #1a365d; }
      .state-label { font-family: system-ui, -apple-system, sans-serif; font-size: 12px; font-weight: 600; fill: white; }
      .state-label-sm { font-family: system-ui, -apple-system, sans-serif; font-size: 10px; font-weight: 600; fill: white; }
      .transition-label { font-family: system-ui, -apple-system, sans-serif; font-size: 10px; fill: #64748b; }
      .arrow { fill: none; stroke: #64748b; stroke-width: 2; marker-end: url(#arrowhead); }
    </style>
    <marker id="arrowhead" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#64748b"/>
    </marker>
  </defs>

  <!-- Background -->
  <rect width="800" height="450" fill="#ffffff"/>

  <!-- Title -->
  <text x="400" y="40" text-anchor="middle" class="title">Agent Lifecycle State Machine</text>

  <!-- SPAWNED (gray) -->
  <circle cx="120" cy="180" r="50" fill="#6b7280"/>
  <text x="120" y="185" text-anchor="middle" class="state-label">SPAWNED</text>

  <!-- IDLE (green) -->
  <circle cx="280" cy="180" r="50" fill="#16a34a"/>
  <text x="280" y="185" text-anchor="middle" class="state-label">IDLE</text>

  <!-- WORKING (blue) -->
  <circle cx="480" cy="180" r="50" fill="#2563eb"/>
  <text x="480" y="185" text-anchor="middle" class="state-label">WORKING</text>

  <!-- BLOCKED (red) -->
  <circle cx="680" cy="180" r="50" fill="#dc2626"/>
  <text x="680" y="185" text-anchor="middle" class="state-label">BLOCKED</text>

  <!-- MEMORY MANAGEMENT (purple - combines handoff, recovery, waiting) -->
  <circle cx="380" cy="320" r="55" fill="#7c3aed"/>
  <text x="380" y="315" text-anchor="middle" class="state-label-sm">MEMORY</text>
  <text x="380" y="330" text-anchor="middle" class="state-label-sm">MANAGEMENT</text>

  <!-- Transitions -->
  <!-- SPAWNED -> IDLE -->
  <path d="M 170 180 L 220 180" class="arrow"/>
  <text x="195" y="170" text-anchor="middle" class="transition-label">/checkin</text>

  <!-- IDLE -> WORKING -->
  <path d="M 330 180 L 420 180" class="arrow"/>
  <text x="375" y="170" text-anchor="middle" class="transition-label">start task</text>

  <!-- WORKING -> BLOCKED -->
  <path d="M 530 180 L 620 180" class="arrow"/>
  <text x="575" y="170" text-anchor="middle" class="transition-label">blocked</text>

  <!-- BLOCKED -> WORKING -->
  <path d="M 620 200 Q 575 235 530 200" class="arrow"/>
  <text x="575" y="245" text-anchor="middle" class="transition-label">unblocked</text>

  <!-- WORKING -> IDLE -->
  <path d="M 430 165 Q 375 120 320 165" class="arrow"/>
  <text x="375" y="115" text-anchor="middle" class="transition-label">task complete</text>

  <!-- IDLE -> CONTEXT MANAGEMENT -->
  <path d="M 280 230 Q 280 280 330 300" class="arrow"/>
  <text x="265" y="275" text-anchor="middle" class="transition-label">/handoff</text>

  <!-- WORKING -> CONTEXT MANAGEMENT -->
  <path d="M 480 230 Q 480 280 430 300" class="arrow"/>
  <text x="495" y="275" text-anchor="middle" class="transition-label">/handoff</text>

  <!-- CONTEXT MANAGEMENT -> IDLE -->
  <path d="M 325 310 Q 260 290 270 230" class="arrow"/>
  <text x="240" y="310" text-anchor="middle" class="transition-label">/recover</text>

  <!-- Legend -->
  <rect x="100" y="390" width="600" height="50" fill="#f8fafc" rx="8"/>
  <text x="120" y="420" font-family="system-ui, sans-serif" font-size="11" fill="#1e293b" font-weight="600">Legend:</text>
  <circle cx="190" cy="415" r="8" fill="#6b7280"/><text x="205" y="419" font-family="system-ui, sans-serif" font-size="10" fill="#64748b">Initial</text>
  <circle cx="280" cy="415" r="8" fill="#16a34a"/><text x="295" y="419" font-family="system-ui, sans-serif" font-size="10" fill="#64748b">Ready</text>
  <circle cx="370" cy="415" r="8" fill="#2563eb"/><text x="385" y="419" font-family="system-ui, sans-serif" font-size="10" fill="#64748b">Active</text>
  <circle cx="460" cy="415" r="8" fill="#dc2626"/><text x="475" y="419" font-family="system-ui, sans-serif" font-size="10" fill="#64748b">Stuck</text>
  <circle cx="550" cy="415" r="8" fill="#7c3aed"/><text x="565" y="419" font-family="system-ui, sans-serif" font-size="10" fill="#64748b">Memory Mgmt</text>
</svg>
